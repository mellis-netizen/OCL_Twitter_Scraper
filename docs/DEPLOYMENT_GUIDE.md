# Complete Deployment Guide - Frontend & Backend

## Part 1: Deploying the Backend (Getting Your API URLs)

Before deploying the frontend to Netlify, you need to deploy the backend API to get the URLs. Here are the best options:

### Option A: Railway.app (Recommended - Easiest)

**Why Railway?**
- Free tier available
- Automatic HTTPS
- PostgreSQL & Redis included
- WebSocket support
- Easy environment variables

**Steps:**

1. **Sign up at [Railway.app](https://railway.app)**

2. **Create New Project**
   - Click "New Project"
   - Select "Deploy from GitHub repo"
   - Connect your GitHub account
   - Select your `OCL_Twitter_Scraper` repository

3. **Add PostgreSQL Database**
   - In your project, click "+ New"
   - Select "Database" → "PostgreSQL"
   - Railway automatically creates `DATABASE_URL`

4. **Add Redis**
   - Click "+ New" again
   - Select "Database" → "Redis"
   - Railway automatically creates `REDIS_URL`

5. **Configure Environment Variables**

   In your Railway service settings, add these variables:
   ```env
   # Python/FastAPI
   PYTHON_VERSION=3.11

   # Database (auto-generated by Railway)
   DATABASE_URL=postgresql://...  # Auto-filled
   REDIS_URL=redis://...          # Auto-filled

   # Security
   SECRET_KEY=<generate with: openssl rand -hex 32>
   ADMIN_USERNAME=admin
   ADMIN_PASSWORD=<your-secure-password>

   # Twitter API
   TWITTER_BEARER_TOKEN=<your-twitter-token>

   # Email
   EMAIL_ENABLED=true
   EMAIL_USER=alerts@yourdomain.com
   EMAIL_PASSWORD=<your-email-password>
   EMAIL_SMTP_HOST=smtp.gmail.com
   EMAIL_SMTP_PORT=587

   # CORS (important!)
   CORS_ORIGINS=https://your-netlify-app.netlify.app
   ```

6. **Create `railway.json` in project root**
   ```json
   {
     "build": {
       "builder": "nixpacks"
     },
     "deploy": {
       "startCommand": "uvicorn src.api:app --host 0.0.0.0 --port $PORT",
       "restartPolicyType": "on-failure",
       "restartPolicyMaxRetries": 10
     }
   }
   ```

7. **Create `Procfile` in project root**
   ```
   web: uvicorn src.api:app --host 0.0.0.0 --port $PORT
   ```

8. **Deploy**
   - Railway auto-deploys on git push
   - Wait for build to complete
   - Railway generates a URL like: `https://your-app.up.railway.app`

9. **Your API URLs are:**
   ```
   API_URL:  https://your-app.up.railway.app
   WS_URL:   wss://your-app.up.railway.app
   ```

   (Note: Railway automatically provides HTTPS, so WebSocket uses `wss://`)

---

### Option B: Render.com (Good Alternative)

**Steps:**

1. **Sign up at [Render.com](https://render.com)**

2. **Create PostgreSQL Database**
   - New → PostgreSQL
   - Note the "Internal Database URL" and "External Database URL"

3. **Create Redis Instance**
   - New → Redis
   - Note the "Internal Redis URL"

4. **Create Web Service**
   - New → Web Service
   - Connect GitHub repository
   - Build Command: `pip install -r requirements.txt`
   - Start Command: `uvicorn src.api:app --host 0.0.0.0 --port $PORT`

5. **Environment Variables** (same as Railway)

6. **Your URLs:**
   ```
   API_URL:  https://your-app.onrender.com
   WS_URL:   wss://your-app.onrender.com
   ```

---

### Option C: Heroku (Classic Choice)

**Steps:**

1. **Install Heroku CLI**
   ```bash
   brew install heroku/brew/heroku  # macOS
   # or download from heroku.com
   ```

2. **Login and Create App**
   ```bash
   heroku login
   heroku create your-tge-monitor-api
   ```

3. **Add PostgreSQL & Redis**
   ```bash
   heroku addons:create heroku-postgresql:mini
   heroku addons:create heroku-redis:mini
   ```

4. **Set Environment Variables**
   ```bash
   heroku config:set SECRET_KEY=$(openssl rand -hex 32)
   heroku config:set ADMIN_USERNAME=admin
   heroku config:set ADMIN_PASSWORD=your-password
   heroku config:set TWITTER_BEARER_TOKEN=your-token
   # ... etc
   ```

5. **Create `Procfile`**
   ```
   web: uvicorn src.api:app --host 0.0.0.0 --port $PORT
   ```

6. **Deploy**
   ```bash
   git push heroku main
   ```

7. **Your URLs:**
   ```
   API_URL:  https://your-tge-monitor-api.herokuapp.com
   WS_URL:   wss://your-tge-monitor-api.herokuapp.com
   ```

---

### Option D: AWS EC2 (Advanced)

See the detailed AWS deployment guide in the main README.md. You'll need:
- EC2 instance with public IP
- Domain name (e.g., api.yourdomain.com)
- SSL certificate (Let's Encrypt)

**Your URLs would be:**
```
API_URL:  https://api.yourdomain.com
WS_URL:   wss://api.yourdomain.com
```

---

## Part 2: Deploying Frontend to Netlify

Once your backend is deployed and you have your API URLs, follow these steps:

### Step-by-Step Netlify Deployment

#### Method 1: Deploy via Netlify UI (Easiest)

1. **Push Frontend to GitHub**
   ```bash
   cd /Users/apple/Documents/GitHub/OCL_Twitter_Scraper
   git add frontend/
   git commit -m "Add production-ready frontend"
   git push origin main
   ```

2. **Sign up at [Netlify.com](https://netlify.com)**

3. **Create New Site**
   - Click "Add new site" → "Import an existing project"
   - Choose "Deploy with GitHub"
   - Authorize Netlify to access your repositories
   - Select your `OCL_Twitter_Scraper` repository

4. **Configure Build Settings**
   ```
   Base directory:    frontend
   Build command:     npm run build
   Publish directory: frontend/dist
   ```

5. **Add Environment Variables** (BEFORE deploying)

   In "Site settings" → "Environment variables", add:
   ```
   VITE_API_URL=https://your-app.up.railway.app
   VITE_WS_URL=wss://your-app.up.railway.app
   ```

   **Important:** Use the URLs from your backend deployment!

6. **Deploy**
   - Click "Deploy site"
   - Netlify will build and deploy automatically
   - You'll get a URL like: `https://random-name-12345.netlify.app`

7. **Custom Domain (Optional)**
   - Go to "Domain settings"
   - Add custom domain
   - Update DNS records as instructed

#### Method 2: Deploy via Netlify CLI

1. **Install Netlify CLI**
   ```bash
   npm install -g netlify-cli
   ```

2. **Login**
   ```bash
   netlify login
   ```

3. **Initialize Netlify in Frontend Directory**
   ```bash
   cd frontend
   netlify init
   ```

   Follow prompts:
   - Create & configure new site
   - Build command: `npm run build`
   - Publish directory: `dist`

4. **Set Environment Variables**
   ```bash
   netlify env:set VITE_API_URL "https://your-app.up.railway.app"
   netlify env:set VITE_WS_URL "wss://your-app.up.railway.app"
   ```

5. **Deploy**
   ```bash
   # Production deployment
   netlify deploy --prod
   ```

---

### Create `netlify.toml` Configuration

Create this file in `frontend/netlify.toml`:

```toml
[build]
  base = "frontend"
  command = "npm run build"
  publish = "dist"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[build.environment]
  NODE_VERSION = "18"

# Headers for security
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"

# Cache static assets
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
```

---

## Complete Example Workflow

### 1. Deploy Backend to Railway

```bash
# In project root
git add .
git commit -m "Prepare for deployment"
git push origin main

# Railway auto-deploys
# Get URL: https://tge-monitor-api.up.railway.app
```

### 2. Update CORS in Backend

In Railway environment variables, set:
```env
CORS_ORIGINS=https://your-netlify-app.netlify.app,https://tge-monitor.netlify.app
```

### 3. Configure Frontend Environment

Update `frontend/.env`:
```env
VITE_API_URL=https://tge-monitor-api.up.railway.app
VITE_WS_URL=wss://tge-monitor-api.up.railway.app
```

### 4. Deploy to Netlify

```bash
cd frontend
netlify deploy --prod
```

Or push to GitHub and let Netlify auto-deploy.

### 5. Test Everything

1. **Visit your Netlify URL:** `https://your-app.netlify.app`
2. **Login** with your admin credentials
3. **Check WebSocket:** You should see "WebSocket: Live" in the sidebar
4. **Create a company** and verify API calls work
5. **Check alerts** to ensure real-time updates work

---

## Troubleshooting

### CORS Errors

**Problem:** Browser console shows CORS errors

**Solution:**
1. Add your Netlify URL to backend `CORS_ORIGINS`
2. Redeploy backend
3. Hard refresh frontend (Cmd+Shift+R)

### WebSocket Connection Fails

**Problem:** WebSocket shows "Disconnected"

**Solution:**
1. Verify `VITE_WS_URL` uses `wss://` (not `ws://`)
2. Check backend supports WebSocket
3. Verify JWT token is being sent

### Environment Variables Not Working

**Problem:** `VITE_API_URL` is undefined

**Solution:**
1. Variables must start with `VITE_`
2. Rebuild after changing environment variables
3. In Netlify, go to Site settings → Environment variables
4. Trigger new deployment

### Build Fails on Netlify

**Problem:** Build fails with module errors

**Solution:**
1. Ensure `package-lock.json` is committed
2. Set Node version in `netlify.toml`: `NODE_VERSION = "18"`
3. Check build logs for specific errors

---

## URL Structure Summary

### Development
```
Frontend:  http://localhost:5173
Backend:   http://localhost:8000
WebSocket: ws://localhost:8000
```

### Production
```
Frontend:  https://your-app.netlify.app
Backend:   https://your-api.railway.app  (or Render/Heroku)
WebSocket: wss://your-api.railway.app
```

### With Custom Domain
```
Frontend:  https://tge-monitor.yourdomain.com
Backend:   https://api.yourdomain.com
WebSocket: wss://api.yourdomain.com
```

---

## Free Tier Limits

### Railway
- $5 free credit/month
- PostgreSQL: 1GB storage
- Redis: 100MB storage
- Unlimited bandwidth

### Netlify
- 100GB bandwidth/month
- 300 build minutes/month
- Unlimited sites
- SSL included

### Render
- 750 hours/month
- PostgreSQL: 1GB storage
- Services sleep after 15 min inactivity

---

## Security Checklist

- [ ] Use HTTPS for API (all platforms provide this)
- [ ] Set strong `SECRET_KEY` and `ADMIN_PASSWORD`
- [ ] Configure CORS to only allow your Netlify domain
- [ ] Use environment variables (never commit secrets)
- [ ] Enable rate limiting in backend
- [ ] Set up SSL/TLS for WebSocket (wss://)
- [ ] Use secure cookie settings if implementing sessions

---

## Cost Estimates (Monthly)

### Hobby/Side Project (Free Tier)
- Railway/Render: Free ($0)
- Netlify: Free ($0)
- **Total: $0/month**

### Small Production App
- Railway Pro: $5-10
- Netlify Pro: $19
- Domain: $12/year
- **Total: ~$25-30/month**

### Medium Production App
- Railway: $20-50
- Netlify: $19
- AWS RDS (PostgreSQL): $25
- AWS ElastiCache (Redis): $15
- **Total: ~$80-110/month**

---

## Next Steps

1. ✅ Deploy backend to Railway/Render/Heroku
2. ✅ Note your API URLs
3. ✅ Update frontend `.env` with API URLs
4. ✅ Deploy frontend to Netlify
5. ✅ Configure custom domain (optional)
6. ✅ Set up monitoring (e.g., UptimeRobot)
7. ✅ Configure alerts for downtime

---

**You're ready to deploy! 🚀**

The entire stack can run on free tiers for development and testing. Upgrade to paid plans when you need more resources or have production traffic.
